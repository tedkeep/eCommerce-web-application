<%@ page import="shop.Product" %><%@ page import="java.util.*" %><%@ page import="shop.ShopDB" %><jsp:useBean id='basket'             scope='session'             class='shop.Basket'/><jsp:useBean id = 'db'             scope='page'             class='shop.ShopDB' /><%    String empty = request.getParameter("emptyBasket");    String item = request.getParameter("pid");    String quantity = request.getParameter("qua");    String deleteItem = request.getParameter("del");    if (deleteItem != null) {        basket.removeItem(deleteItem);    }    if (empty != null) {        basket.clearBasket();    }    HashMap<String, Integer> itemsMap = basket.getItems();    if (!itemsMap.containsKey(item) && quantity == null) {        basket.addItem(item);    } else if (itemsMap.containsKey(item) && quantity != null) {        basket.updateItem(item, Integer.parseInt(quantity));    }%><%@include file="menu.html"%><script>    function checkUsername() {        if (document.getElementById("username").value === "") {            alert("Please enter a name before buying the products");            return false;        }    }    function checkQuantityInput(event) {        console.log("i fired");        var input = event.target;        var parent = event.target.parentElement;        var id = "#" + event.target.id + "button";        var button = parent.querySelector(id);        console.log(event.target.id + "Button");        if (input.value <= 0) {            button.style.display = "none";        } else {            button.style.display = "inline-block";        }    }</script><div id="main"><table style="border: solid 1px black">    <thead>    <tr>        <th colspan="2">Product</th>        <th>Quantity</th>        <th>Price</th>    </tr>    </thead>    <tbody>    <%        if (basket.getTotal() > 0) {            HashMap<String, Integer> items = basket.getItems();            for (Map.Entry<String, Integer> prod : items.entrySet()) {                Product p = db.getProduct(prod.getKey());                double price = p.price / 100.00;    %>    <tr>        <td> <%= p.title %> </td>        <td><img src="<%= p.thumbnail %>"></td>        <td>            <form action="basket.jsp" onkeypress="return event.keyCode !== 13;">                <input type="hidden" name="pid" value="<%=p.PID%>"/>                <input type="number" name="qua" maxlength="4" size="4" value="<%=prod.getValue()%>" id="<%=p.PID%>" oninput="checkQuantityInput(event)"/>                <input type="submit" value="update" id="<%=p.PID%>Button" style="display: none"/>            </form>        </td>        <td> <%= "&pound;" + String.format("%.2f", (price * prod.getValue())) %> </td>        <td>            <form action="basket.jsp">                <input type="hidden" name="del" value="<%=p.PID%>"/>                <input type="submit" value="Delete"/>            </form>        </td>    </tr>    <% }    } else { %>    <tr>        <td colspan="4">No items in the basket</td>    </tr>    <% } %>    </tbody>    <tfoot>        <tr>            <td colspan="4">                Order total = <%= "&pound;" + basket.getTotalString() %>            </td>        </tr>    </tfoot></table><%    if (basket.getTotal() > 0) {%><form action="basket.jsp"></form><form action="order.jsp" method="post" onsubmit="return checkUsername()">    <input id="username" type="text" name="name" size="20"/>    <input type="submit" value="Place Order"/></form><form action="basket.jsp" method="get">    <input type="hidden" name="emptyBasket" value="yes"/>    <input type="submit" value="Empty Basket"/></form><%    }%></div></body></html>